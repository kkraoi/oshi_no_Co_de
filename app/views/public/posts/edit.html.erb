<% content_for :title, "投稿｜#{@post.title}の編集ページ" %>
<% content_for :head do %>
  <%= stylesheet_link_tag 'public/posts', media: 'all' %>
<% end %>
<% content_for :foot do %>
<% end %>
<% content_for :body_class, "js-posts-new" %>

<%= form_with model:@post, url: post_path(@post), method: :patch, local: true do |f| %>
<div class="u-col2" id="js-col2-root">
  <div class="u-col2-main">
    <div class="u-col2-main-inner">
      <h1 class="u-title u-pt-50"><%= @post.title %><br>の編集ページ</h1>

      <%# タイトル %>
      <div class="u-scroll-target" id="test">
        <section class="u-sec">
          <div class="u-inner-4">
            <h2 class="u-title-1">タイトル</h2>
            <%= render 'public/shared/field_error', object: @post, field: :title %>
            <%= f.text_field :title, class: "u-field" %>
          </div>
        </section>
      </div>

      <%# コード %>
      <div class="u-scroll-target" id="test">
        <section class="u-sec">
          <div class="u-inner-4">
            <h2 class="u-title-1">コード</h2>
            <div id="js-code-fields-container">
              <%= f.fields_for :codes do |code_fields| %>
                <%= render 'code_fields', f: code_fields %>
              <% end %>
            </div>
            <div class="u-btn-wrap u-mt-30">
              <button type="button" id="js-add-code-field" class="u-btn" aria-label="フィールドを追加する">追加</button>
            </div>
            <template id="js-code-field-template">
              <%# raw() => テンプレで使うコードをエスケープすると、文字列のまま出力されてしまう。なのでそれを防止する。セキュリティ面: このケースはユーザーが入力する使い方をしていないので、問題ない。 %>
              <%# gsub("\n", "") => テンプレ内部の改行を取り除く %>
              <%# jsで扱うHTML文字列を1行にしてバグなどを防ぐ %>
              <%= raw(render('code_fields', f: nil).gsub("\n", "")) %>
            </template>
          </div>
        </section>
      </div>

      <%# 解説 %>
      <div class="u-scroll-target" id="test">
        <section class="u-sec">
          <div class="u-inner-4">
            <h2 class="u-title-1">解説</h2>
            <%= render 'public/shared/field_error', object: @post, field: :introduction %>
            <%= f.text_area :description, class: "u-field-text_area" %>
          </div>
        </section>
      </div>
    </div>
  </div>

  <aside class="u-col2-side">
    <button type="button" id="js-col2-drawer" class="u-btn-1 type-1 opt-size-s u-col2-drawer" aria-label="サイドメニューを開閉する ">
      <span class="icon-right">
        <i class="fa-solid fa-arrow-right"></i>
      </span>
      <span class="icon-left">
        <i class="fa-solid fa-arrow-left"></i>
      </span>
    </button>

    <div class="u-col2-side-content">
      <div class="u-col2-side-inner">
        <div class="u-side">
          <div class="u-side-body">
            <menu class="u-menu">
              <li>
                <a href="#test">リンク</a>
              </li>
            </menu>
          </div>
          <div class="u-side-foot">
            <%= f.submit "編集内容を保存", class: "u-btn opt-size-full" %>
          </div>
        </div>
      </div>
    </div>
  </aside>
</div>
<% end %>